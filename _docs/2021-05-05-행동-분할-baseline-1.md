---
layout: post
title:  "실시간 행동 분할 논문 1"
# nav_order: 
date:   2021-05-05 16:00:00 +0900
# categories: jekyll update
---

# Paper
> _S. Aminikhanghahi and D. J. Cook, "**Using change point detection to automate daily activity segmentation**," 2017 IEEE International Conference on Pervasive Computing and Communications Workshops (PerCom Workshops), 2017, pp. 262-267, doi: 10.1109/PERCOMW.2017.7917569._

# Target Problem
> * **Real-time** 
* **Activity Transition Detection (ATD) for "Segmentation"** 
* **Sensor-based data from "real-world smart home"**

# Why is it important
> * Human Activity Recognition (HAR) 에서 Model을 학습시키려면 <u>Activity의 시작과 끝이 잘 described된 a set of stream segments</u>가 필요하다; **Activity Segmentation**
	- 각 segment는 non-overlapped, single activity
* Real-time HAR에서는 Model Training과 동시에, Input sensor stream에 대한 Activity Inference를 제공해야 한다. 그러려면 **Raw stream을 Segmentation하고 Recognition하는 과정이 parallel하게 수행되어야 함.**

# Previous Works
>* <u>**미리 잘려진, 라벨링된, 전체 데이터 (pre-segmented, labelled, batch)**</u>를 사용했다; **offline**
>> *real-time으로 적용할 수 없는 main problem*
* <u>기존 sliding window 방식은 **optimal** window size를 구하기 어렵다</u>는 한계


>* ATD 알고리즘은 크게 **Unsupervised 또는 supervised** 방식으로 나뉨
>> (1) Supervised: multi-class or binary classification
    ** 여러 activity 간 boundary를 g.t. information으로 받아서 multi-class classifier를 학습** 하거나
    ** binary 하게 transition/non-transition를 학습시킴 **
    - transition의 possible type 수가 많아질수록 complex learning 문제
    - extreme class imbalance 문제
>>> <u>***(2) Unsupervised:***
      **prior training 없이 data의 statistical feature만을 기반으로 transition을 찾음**</u>
      - * PCA, Eigenspace를 활용한 Semi-supervised 방식 (subject-specific data가 학습에 필요함) *
      - * minimized contrast with sliding window autocorrelation correctness (Accelerometer 데이터만 사용함; uni-modal) *
      - *** gestural AR using CPD (RuLSIF - relative density-ratio estimator를 사용함) ***
      
> 즉, **Time-series change point detection (CPD)** 문제로 접근; Challenging Task
        1. Activity 간 transition을 정의하기 어렵고 
        2. Activity의 시작과 종료 또한 명확하지 않다


    
    
# Methods (Segmentation Model)
> 1. **Data Collection**
	- <u>Single-resident</u>, CASAS smart home; 3 apartment datasets
      - 13 activities (12 pre-defined + "Other" activity)
    - Used sensors: <u>Motion and Door</u>
    - Data format: {date, time, sensorID, value}
    
> 2. Extract **"Event features"**
	- Sliding window (**30** events)
    - Features (of each window): **Duration, Latest Event Time, Dominant Sensor, Occurrence of each sensor, Last fired time of each sensor**
          - total **3+2N** features
    >> - Feature Normalization: 각 feature를 [0, 1]로 변환
          - D는 window들의 **{min_D, max_D}**을 update하면서 적용
          - LET는 second 기준으로 **{0, 60x60x24-1}**를 적용
          - DS는 해당 SensorID에 **{0, len(sensors)-1}**를 적용
          - O는 **{0, 30}**을 적용
          - LFT는 **{0, D}**를 적용
          
> 3. **Activity Transition Detection (ATD)**
    - real-time, **discrete binary sensor data**에 대한 알고리즘
    - Assumption: **feature space의 data distribution 변화만으로 transition을 감지한다.**
    >>- 두 가지의 unsupervised 알고리즘
  1) **RuLSIF** (Relative unconstrained Least-Squares Importance Fitting)
  	: <u>두 개의 연속적인 event window 간의 data distribution 변화를 관찰 </u>
  2) **BCPD** (Bayesian Change Point Detection)
  	: <u>이전 Change Point Candidate 이후의 데이터와 현재 window의 확률 분포를 비교</u>
    - **RuLSIF를 중심으로 설명함**
    
> 4. Extract **"Segment features"**
	- ATD로 얻은 Change Points를 기준으로 stream을 자른 뒤 feature를 뽑아냄
5. **Activity Recognition (AR)**
	- Decision Tree, Random Forest, Extra Trees, Gradient Boosting, Bagging, AdaBoost 등 다양한 Multi-class classifier를 가지고 Performance 측정


# RuLSIF
>* two samples 간의 relative (probability) density-ratio를 추정
  - 계산된 ratio와 미리 설정해둔 threshold를 비교하여 change를 결정함
  - threshold = 0.9
  - **current point의 dissimilarity score: 이전 two events의 score 합**
  
>* direct density-ratio estimation
  - non-parametric Gaussian Kernel Model을 사용함; weighted sum of kernels
  - <u>Cross-validation</u>을 통해, **dissimilarity measure**를 minimize하는 <u>Weights와 Kernel Parameter, Regularization Term</u>을 구할 수 있음
  - Dissimilarity Measure: **alpha-relative Pearson Divergence (PE)**
  	- alpha = 0.5, according to figure
    
>* *n*-real time algorithm
  - CPD를 하려면 현재 event로부터 <u>*n*개의 future events</u>가 추가로 필요함
  - *n*=2
  
# Evaluation
>* Dataset의 average duration이 12분
  - 실제 transition event로부터 **+-15초** 안에 candidate event가 있으면, 해당 event는 **true positive**
  
>* **RuLSIF는 BCPD와 fixed sliding window (baseline)보다 높은 ATD performance를 보임**
  - (True Positive Rate) baseline: 0.2, **RuLSIF: 0.7**, BCPD: 0.4
  - (Geometric Mean) baseline: 0.44, **RuLSIF: 0.82**, BCPD: 0.62
  - (Mean Absolute Error) baseline: 33.4, **RuLSIF: 3.5**, BCPD: 7.0

> * HAR performance는 BCPD가 RuLSIF와 큰 차이가 없음
  - Accurate한 transition을 찾으려면 RuLSIF
  - activity의 전반적인 trend를 찾으려면 BCPD
  
# Discussion
>* 논문에서 제안하는 알고리즘이 Non-parametric Kernel Model을 사용해서 CPD 알고리즘 내부적으로는 추가적인 parameter 설정이 필요없지만, 그래도 **ATD 성능은 다른 Parameter Tuning의 결과에 민감하다.**
>>* CASAS Dataset의 특성에 최적화된 parameter (한 달 동안 random search로 찾은 결과); 다른 smart home dataset에 대해서도 성능이 보장되지 않을 것이다. - 즉, **generalize하기 어려운 모델.**
  - window size *ws=30*
  - view size *n=2*
  - minimum distance between transitions *1*
  - threshold value *0.9*
  - alpha *0.5*
  
>* **Evaluation 방식에 대해, 개인적으로 드는 의문;**
  - 예를 들어 10000개의 events가 있고, 실제 transition은 100개라고 하자.
  - 위와 같이 TPR이 0.7이고, G-Mean이 0.82면 FPR은 0.1 (1-TNR)정도 될 것이다.
        - TPR: TP/P = TP/{TP+FN} = 70/{70+30}
        - FPR: FP/N = FP/{FP+TN} = 990/{9900}
        - TP가 100개 이상이 될 수 있기 때문에, 위 값은 약간 차이가 있을 수 있으나 크게 안 벗어남.
  - 그렇다면 P는 100개, N은 9900개; TP는 70개, FP는 990개이다
** FP가 990개인데 어떻게 Segmentation을 하지? **
FP라는 것은 결국 Activity 중간 지점마다 위치한 Candidate (Wrong Detected Point)인데, 이 부분을 다 잘라버리면 Segment는 엉망진창이 될 것.
** +-15초에 위치한 Event를 전부 Positive로 간주하나?**
이렇게 생각하더라도 결국 FPR은 안 변함.
즉 압도적으로 N이 많은 상황에서, 논문에서 말하듯이 FPR이 10%-15% 정도 된다는 것은 Wrong Detection Point가 수천-수만 개가 된다는 얘기고 이 지점들에서 전부 잘려버린다는 얘기인데 - **그러면 이 Segmentation이 의미가 있나?**