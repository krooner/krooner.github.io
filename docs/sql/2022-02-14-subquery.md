---
layout: post
title:  "서브쿼리"
parent: SQL
nav_order: 4
date:   2022-02-14 16:12:00 +0900
---
# Subqueries
{: .no_toc }

<details open markdown="block">
  <summary>
    목차
  </summary>
  {: .text-delta }
1. TOC
{:toc}
</details>

## WHERE 문 내 서브쿼리
---
`States` 테이블

| name|indep_year |fert_rate |women_parli_perc |
|---|---|---|---|
| Australia | 1901 | 1.88 |32.74|
| Brunei| 1984| 1.96| 6.06| 
| Chile| 1810| 1.8| 15.82
| Egypt| 1922| 2.7| 14.9
|Haiti| 1804| 3.03| 2.74
|India| 1947| 2.43| 11.58
|Liberia| 1847| 4.64| 11.65
|Norway| 1905| 1.93| 39.6
|Oman| 1951| 2.75| 8.82
| Portugal| 1143| 1.31| 34.8
| Spain| 1492| 1.53| 38.64
|Uruguay| 1828| 2.03| 22.31
|Vietnam| 1945| 1.7| 24

```sql
--- 전 세계 출산율 평균 이하인 아시아 국가 이름과 출산율
SELECT name, fert_rate
FROM states
WHERE continent = 'Asia'
    AND fert_rate <
        (SELECT AVG(fert_rate)
         FROM states);
```

OUTPUT

|name|fert_rate|
|---|---|
|Brunei|1.96|
|Vietnam|1.7|

## SELECT 문 내 서브쿼리
---
```sql
-- 대륙별 수상 보유 국가의 수
SELECT DISTINCT continent,
    (SELECT COUNT(*)
     FROM states
     WHERE prime_ministers.continent = states.continent) AS countries_num
FROM prime_ministers;
```

OUTPUT

|continent|countries_num|
|---|---|
|Africa|2|
|Asia|4|
|Europe|3|
|North America|1|
|Oceania|1|

## FROM 문 내 서브쿼리
---
```sql
-- 군주가 존재하는 대륙과 대륙 구성 나라 중 의회 내 여성 구성 비율의 최댓값
SELECT DISTINCT monarchs.continent, subquery.max_perc
FROM monarchs,
    (SELECT continent, MAX(women_parli_perc) AS max_perc
     FROM states
     GROUP BY continent) AS subquery
WHERE monarchs.continent = subquery.continent
ORDER BY continent;
```

OUTPUT

|continent|max_perc|
|---|---|
|Asia|24|
|Europe|39.6|